import j from"./rqtZmSiP.js";import{d as q,Z as X,$ as Y,r as s,H as V,c as o,e as r,k as _,f as t,M as A,g as c,V as I,W,t as P,a_ as $,h as U,n as L,X as J,a1 as m,p as Q,j as ee,l as te}from"./CH0slHa8.js";const S=x=>(Q("data-v-5867f86e"),x=x(),ee(),x),se={class:"bg-base-200 flex flex-col items-center p-4 rounded-2xl"},ae=S(()=>t("h1",{class:"text-3xl font-bold text-primary mb-4"},"Kind Robots",-1)),oe={key:0,class:"text-lg text-info mb-4"},re=S(()=>t("a",{href:"/dashboard",class:"text-accent"},"go to the dashboard",-1)),le={key:0},ne=S(()=>t("h1",{class:"text-4xl font-bold text-primary mb-4"}," Pick a Cool Username ",-1)),ie={class:"relative mb-4"},ue={key:0,class:"absolute text-xs text-warning right-2 bottom-1"},ce={key:1},de={class:"text-2xl font-semibold text-primary mb-2"},ve=S(()=>t("p",{class:"text-lg mb-2"},"Optional details:",-1)),me={class:"relative group mb-4"},pe={class:"relative group mb-4"},ge=["type"],be={class:"absolute inset-y-0 right-0 flex items-center pr-3"},fe={key:0,class:"text-xs text-warning right-2 bottom-1 absolute"},he={key:0,class:"relative group mb-4"},_e=["type"],xe={class:"absolute inset-y-0 right-0 flex items-center pr-3"},ye={key:1,class:"my-2 px-4 py-2 text-lg text-info bg-info-light rounded"},we={key:2,class:"my-2 px-4 py-2 text-lg text-warning bg-warning-light rounded"},Re=["disabled"],ke={key:0},Ee={key:1},Ie=q({__name:"registration-form",setup(x){const d=X(),v=Y();d.initializeUser();const i=s(""),C=s(""),l=s(""),y=s(""),f=s(!1),w=s(""),h=s(""),R=s(!1),N=s(""),k=s(!1),u=s(""),E=s(1),p=s(!1),g=s(!1),M=()=>{if(!l.value){u.value="",g.value=!1;return}const a=/^.{8,}$/,e=/\d/,b=/[a-zA-Z]/;a.test(l.value)?e.test(l.value)?b.test(l.value)?(u.value="",g.value=!0):(u.value="Include at least one letter",g.value=!1):(u.value="Include at least one number",g.value=!1):(u.value="At least 8 characters",g.value=!1)},H=()=>{l.value&&l.value!==y.value?u.value="Passwords do not match":u.value=""},K=s(""),D=async()=>{try{const a=await d.getUsernames();f.value=a.includes(i.value),f.value?h.value=`Username "${i.value}" already exists.`:h.value=""}catch(a){a instanceof Error?v.setError(m.UNKNOWN_ERROR,`Error checking username availability: ${a.message}`):v.setError(m.UNKNOWN_ERROR,"An unknown error occurred while checking username availability.")}},O=a=>{a===2&&(K.value=`Welcome, ${i.value}!`),E.value=a},T=V(()=>i.value&&!f.value&&(E.value===1||(!l.value||!u.value)&&l.value===y.value)),z=()=>{k.value=!k.value},B=()=>{p.value=!p.value},G=V(()=>d.isLoggedIn),F=()=>{localStorage.removeItem("api_key"),localStorage.removeItem("token")},Z=async()=>{if(T.value){R.value=!0,N.value="Registering user...";try{if(F(),(await d.register({username:i.value})).success){N.value="Welcome to Kind Robots!",w.value="Welcome to Kind Robots!";try{const e=await d.login(i.value,l.value);if(!e.success)throw new Error(e.message||"Login failed")}catch(e){e instanceof Error?v.setError(m.AUTH_ERROR,`Login failed: ${e.message}`):v.setError(m.AUTH_ERROR,"An unknown error occurred during login.")}}else w.value="",h.value="Registration failed. Please try again.",v.setError(m.REGISTRATION_ERROR,"Registration failed. Please try again.")}catch(a){a instanceof Error?v.setError(m.REGISTRATION_ERROR,`Registration failed: ${a.message}`):v.setError(m.REGISTRATION_ERROR,"An unknown error occurred during registration.")}R.value=!1}};return(a,e)=>{const b=j;return o(),r("div",se,[ae,G.value?(o(),r("div",oe,[_(" You are already logged in. Would you like to "),re,_(" or "),t("a",{href:"#",class:"text-warning",onClick:e[0]||(e[0]=(...n)=>A(d).logout&&A(d).logout(...n))},"log out"),_("? ")])):c("",!0),t("form",{class:"space-y-4 w-full max-w-sm",onSubmit:J(Z,["prevent"])},[E.value===1?(o(),r("div",le,[ne,t("div",ie,[I(t("input",{"onUpdate:modelValue":e[1]||(e[1]=n=>i.value=n),type:"text",placeholder:"Username",required:"",class:"w-full p-2 border rounded text-4xl bg-base-200 placeholder-base-300","aria-label":"Username",autocomplete:"username",onInput:D},null,544),[[W,i.value]]),f.value?(o(),r("p",ue," Username already exists ")):c("",!0)]),i.value&&!f.value?(o(),r("button",{key:0,type:"button",class:"w-full bg-primary text-lg text-base-100 p-2 rounded hover:bg-primary-dark transition duration-300",onClick:e[2]||(e[2]=n=>O(2))}," That's my name! ")):c("",!0)])):c("",!0),E.value===2?(o(),r("div",ce,[t("h2",de," Welcome, "+P(i.value)+"! ",1),t("button",{type:"button",class:"text-md mb-4",onClick:e[3]||(e[3]=n=>O(1))}," I want a different username "),ve,t("div",me,[I(t("input",{"onUpdate:modelValue":e[4]||(e[4]=n=>C.value=n),type:"email",placeholder:"Email (optional)",class:"w-full p-2 border rounded text-lg bg-base-200 placeholder-base-300","aria-label":"Email",autocomplete:"email"},null,512),[[W,C.value]])]),t("div",pe,[I(t("input",{"onUpdate:modelValue":e[5]||(e[5]=n=>l.value=n),type:k.value?"text":"password",placeholder:"Password (keep it blank if you prefer)",class:"w-full p-2 border rounded text-lg bg-base-200 placeholder-base-300","aria-label":"Password",autocomplete:"new-password",onInput:M},null,40,ge),[[$,l.value]]),t("div",be,[U(b,{name:"tabler:eye",class:L(k.value?"text-base-300 cursor-pointer hover:text-warning":"text-base-300 cursor-pointer hover:text-success"),title:"Show/Hide Password",onClick:z},null,8,["class"])]),u.value?(o(),r("p",fe,P(u.value),1)):c("",!0)]),g.value?(o(),r("div",he,[I(t("input",{"onUpdate:modelValue":e[6]||(e[6]=n=>y.value=n),type:p.value?"text":"password",placeholder:"Confirm Password",class:"w-full p-2 border rounded text-lg bg-base-200 placeholder-base-300","aria-label":"Confirm Password",autocomplete:"new-password",onInput:H},null,40,_e),[[$,y.value]]),t("div",xe,[U(b,{name:p.value?"tabler:eye-off":"tabler:eye",class:L(p.value?"text-base-300 cursor-pointer hover:text-warning":"text-base-300 cursor-pointer hover:text-success"),title:p.value?"Hide Password":"Show Password",onClick:B},null,8,["name","class","title"])])])):c("",!0),w.value?(o(),r("div",ye,[U(b,{name:"tabler:info-circle",class:"mr-2"}),_(" "+P(w.value),1)])):c("",!0),h.value?(o(),r("div",we,[U(b,{name:"tabler:alert-triangle",class:"mr-2"}),_(" "+P(h.value),1)])):c("",!0),t("button",{type:"submit",disabled:!T.value||R.value,class:"w-full bg-primary text-lg text-base-100 p-2 rounded hover:bg-primary-dark transition duration-300"},[R.value?(o(),r("span",ke,"Registering...")):(o(),r("span",Ee,"Register"))],8,Re)])):c("",!0)],32)])}}}),Se=te(Ie,[["__scopeId","data-v-5867f86e"]]);export{Se as default};
