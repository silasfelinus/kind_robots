<template>
  <div class="bg-base-300 min-h-screen">
    <!-- Folder View -->
<div
  v-if="folderNames.length && !selectedComponents.length"
  class="flex-1 min-h-0 overflow-y-auto grid grid-cols-[repeat(auto-fit,_minmax(150px,_1fr))] gap-4 p-4"
>
  <!-- Folders -->
  <div
    v-for="folder in folderNames"
    :key="folder"
    class="rounded-lg hover:bg-primary hover:text-default cursor-pointer transition-transform transform hover:scale-105"
    @click="fetchComponentsFromFolder(folder)"
  >
    <div class="text-center">
      <Icon name="kind-icon:folder" class="text-4xl" />
      <p class="mt-2">{{ folder }}</p>
    </div>
  </div>
</div>

    <!-- Component List View -->
    <div v-if="selectedComponents.length" class="flex flex-col h-[80vh]">
      <!-- Back Button -->
      <button
        class="mb-4 bg-primary text-default py-2 rounded hover:bg-secondary transition"
        @click="goBackToFolders"
      >
        Back to Folders
      </button>

      <!-- Scrollable Component Grid -->
      <div
        class="overflow-y-auto flex-grow grid grid-cols-[repeat(auto-fit,_minmax(150px,_1fr))] gap-4 pr-2"
      >
        <div
          v-for="component in selectedComponents"
          :key="component.id"
          class="rounded-lg hover:bg-secondary hover:text-default cursor-pointer transition-transform transform hover:scale-105"
          @click="selectComponent(component)"
        >
          <div class="text-center">
            <Icon name="kind-icon:companion-cube" class="text-4xl mb-2" />
            <p>{{ component.componentName }}</p>
            <p v-if="component.title" class="text-xs">{{ component.title }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, onMounted } from 'vue'
import {
  useComponentStore,
  type KindComponent as Component,
} from './../../../stores/componentStore'

// State variables
const selectedComponents = ref<Component[]>([])
const selectedFolder = ref<string | null>(null)

// Access the component store
const componentStore = useComponentStore()

// Get unique folder names from the componentStore
const folderNames = computed(() => {
  const folders = new Set(
    componentStore.components.map((component) => component.folderName),
  )
  return Array.from(folders)
})

// Fetch components for a selected folder from the store
const fetchComponentsFromFolder = (folderName: string) => {
  selectedComponents.value = componentStore.components.filter(
    (component) => component.folderName === folderName,
  )
  selectedFolder.value = folderName
}

// Select a component and update the store
const selectComponent = (component: Component) => {
  componentStore.selectedComponent = component
}

// Go back to the folder view by clearing the selected components
const goBackToFolders = () => {
  selectedComponents.value = []
  selectedFolder.value = null
}

// Initial fetch from store on component mount
onMounted(() => {
  if (!componentStore.components.length) {
    componentStore.initializeComponents()
  }
})
</script>
