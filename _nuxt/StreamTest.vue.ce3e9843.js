import{_ as ae}from"./bot-carousel2.vue.613d8134.js";import{_ as oe}from"./milestone-reward.vue.d0b96192.js";import{d as ne,r as _,o as le,aV as re,W as ce,aW as ue,E as C,ai as j,b as r,c,N as w,e as o,g as h,t as R,f as d,Y as X,Z,aU as q,G as ie,F as H,a4 as J,n as I,C as K,X as de,aK as ve}from"./entry.85174c6b.js";import{_ as me}from"./ResponseEntry.vue.c7b13c55.js";import _e from"./Icon.9ce9a04e.js";import{a as Q}from"./axios.47b9d439.js";const pe={class:"container rounded-2xl mx-auto p-2 bg-base-200"},ge={key:0,class:"avatar-container w-full m-2 rounded-lg"},he={class:"flex-grow rounded-2xl m-2 p-2 border bg-base-200"},be={class:"flex-1 text-center"},fe={class:"text-3xl font-bold"},ye={class:"text-xl"},ke={class:"card mt-2"},Ce={class:"message-container bg-base-200 p-1 rounded-2xl"},we={class:"prompt-area p-2 rounded-2xl"},Ie={for:"newMessage",class:"block mb-2 font-bold"},xe={key:0,class:"user-intro p-2 rounded-2xl m-2"},$e={class:"text-lg"},Se=["onKeyup"],Me=["disabled"],Be={key:0,class:"loader flex justify-center mt-2"},Ee=["onClick"],Ne={class:"reaction-buttons mt-2 flex space-x-2"},Re=["onClick"],Ke={key:0,class:"popup"},Ue=["onClick"],Ve={key:1,class:"popup"},Ae=["onClick"],De={key:2,class:"popup"},Fe=["onClick"],Te={key:3,class:"popup"},je={key:0,class:"mt-2 flex items-center"},ze=["onKeyup"],Le=["disabled","onClick"],Pe={key:0,class:"loader flex justify-center mt-2 ml-2"},Oe=["onClick"],Je=ne({__name:"StreamTest",setup(We){const z=_(!1);let L=null;le(()=>{L=localStorage.getItem("user_openai_key")});const u=_([]),x=_(null),U=re(),$=ce(),S=ue(),n=C(()=>U.currentBot),b=_(""),y=_(""),M=_(!1),ee=_(null);C(()=>{var e;return(e=$.user)==null?void 0:e.avatarImage});const B=_(!1),V=C(()=>$.userId||0),A=C(()=>{var e;return((e=U.currentBot)==null?void 0:e.id)||0}),D=C(()=>{var e;return((e=U.currentBot)==null?void 0:e.name)||""}),F=C(()=>$.username),p=_({});function T(e,t,a,i,v){var f,s;const g=((f=e.find(k=>k.role==="user"))==null?void 0:f.content)??"",m=((s=e.find(k=>k.role==="assistant"))==null?void 0:s.content)??"";return{id:0,createdAt:new Date,updatedAt:new Date,botId:a,botName:i,userId:t,username:v,userPrompt:g,botResponse:m,liked:null,hated:null,loved:null,flagged:null,previousEntryId:0}}const E=(e,t)=>{const a=S.getExchangeById(e);return a==null?void 0:a[t]};j(()=>{if(u.value.length>0){const e=u.value[u.value.length-1],t=T(e,V.value,A.value,D.value,F.value);S.addOrUpdateExchange(t)}});const P=async()=>{var e,t,a,i,v;M.value=!0;try{const g=(e=n.value)!=null&&e.userIntro?`${n.value.userIntro} ${b.value}`:b.value;z.value=!0;const m=await Q.post("/api/botcafe/chat",{model:"gpt-3.5-turbo",messages:[{role:"user",content:g}],stream:!1,user_openai_key:L},{headers:{"Content-Type":"application/json",Accept:"application/json"}});u.value.push([{role:"user",content:b.value,avatarImage:((t=$.user)==null?void 0:t.avatarImage)??void 0},{role:"assistant",content:m.data.choices[0].message.content,avatarImage:(a=n.value)==null?void 0:a.avatarImage,botName:(i=n.value)==null?void 0:i.name,subtitle:(v=n.value)==null?void 0:v.subtitle}]),b.value=""}catch(g){console.error(g),ee.value="Failed to send the message. Please try again."}finally{M.value=!1}},N=(e,t)=>{const a=T(u.value[e],V.value,A.value,D.value,F.value);if(a&&a.id){const i=a[t]??!1;S.addReaction(a.id,{[t]:!i})}p.value[e]||(p.value[e]={}),p.value[e][t]=!0,setTimeout(()=>{p.value[e][t]=!1},2e3)},O=async e=>{var t;B.value=!0;try{const a=u.value[e].map(({avatarImage:g,botName:m,subtitle:f,...s})=>s),i=(t=n.value)!=null&&t.userIntro?`${n.value.userIntro} ${y.value}`:y.value;a.push({role:"user",content:i});const v=await Q.post("/api/botcafe/chat",{model:"gpt-3.5-turbo",messages:a,stream:!1});u.value[e].push({role:"user",content:y.value}),u.value[e].push({role:"assistant",content:v.data.choices[0].message.content}),y.value=""}catch(a){console.error(a)}B.value=!1};j(()=>{if(u.value.length>0){const e=u.value[u.value.length-1],t=T(e,V.value,A.value,D.value,F.value);S.addOrUpdateExchange(t)}}),j(()=>{n.value&&n.value.prompt&&(b.value=n.value.prompt)});const te=e=>{u.value.splice(e,1),x.value=null};return(e,t)=>{const a=ae,i=oe,v=ve,g=me,m=_e;return r(),c("div",pe,[w(n)?(r(),c("div",ge,[o("div",he,[h(a),o("div",be,[o("h1",fe,R(w(n).name??"Unknown Bot"),1),o("p",ye,R(w(n).subtitle??"Subtitle"),1),o("div",ke,R(w(n).description??"Description"),1)])])])):d("",!0),o("div",Ce,[o("div",we,[o("label",Ie,[w(n)?(r(),c("div",xe,[o("p",$e,R(w(n).userIntro??"User Intro"),1)])):d("",!0)]),X(o("textarea",{id:"newMessage","onUpdate:modelValue":t[0]||(t[0]=f=>b.value=f),rows:"5",class:"message-input w-full p-2 rounded-md border-2 resize-none",placeholder:"Type your message...",onKeyup:q(P,["enter"])},null,40,Se),[[Z,b.value]]),o("button",{class:"submit-button btn btn-primary mt-2",disabled:M.value,onClick:P}," Send Message ",8,Me),z.value?(r(),ie(i,{key:0,id:4})):d("",!0)]),M.value?(r(),c("div",Be,[h(v)])):d("",!0),(r(!0),c(H,null,J(u.value,(f,s)=>{var k,W,Y,G;return r(),c("div",{key:s,class:"response-container m-2 p-4 bg-white rounded-md shadow-md relative flex flex-col items-start",onClick:l=>x.value=s},[(r(!0),c(H,null,J(f,(l,se)=>(r(),c("div",{key:se,class:I([{"flex-row-reverse":l.role==="user"},"flex items-center"])},[h(g,{role:l.role,content:l.content,"avatar-image":l.avatarImage??"/images/kindtitle.webp","bot-name":l.botName??"Kind Robot",subtitle:l.subtitle??"Your friendly neighborhood AI"},null,8,["role","content","avatar-image","bot-name","subtitle"])],2))),128)),o("div",Ne,[o("button",{class:I(["hover:bg-gray-200",{"bg-primary":E(s,"liked")}]),onClick:l=>N(s,"liked")}," 👍 ",10,Re),(k=p.value[s])!=null&&k.liked?(r(),c("div",Ke,[K(" Response Liked "),h(m,{name:"like",class:"icon-class"})])):d("",!0),o("button",{class:I(["hover:bg-gray-200",{"bg-primary":E(s,"hated")}]),onClick:l=>N(s,"hated")}," 👎 ",10,Ue),(W=p.value[s])!=null&&W.hated?(r(),c("div",Ve,[K(" Response hated "),h(m,{name:"hate",class:"icon-class"})])):d("",!0),o("button",{class:I(["hover:bg-gray-200",{"bg-primary":E(s,"loved")}]),onClick:l=>N(s,"loved")}," ❤️ ",10,Ae),(Y=p.value[s])!=null&&Y.loved?(r(),c("div",De,[K(" Favorited "),h(m,{name:"❤️",class:"icon-class"})])):d("",!0),o("button",{class:I(["hover:bg-gray-200",{"bg-primary":E(s,"flagged")}]),onClick:l=>N(s,"flagged")}," 🚩 ",10,Fe),(G=p.value[s])!=null&&G.flagged?(r(),c("div",Te,[K(" Flagged "),h(m,{name:"🚩",class:"icon-class"})])):d("",!0)]),x.value!==null&&x.value===s?(r(),c("div",je,[X(o("textarea",{"onUpdate:modelValue":t[1]||(t[1]=l=>y.value=l),type:"text",rows:"3",placeholder:"Continue conversation...",class:"flex-grow p-2 rounded-md border-2 text-lg resize-y",onKeyup:q(l=>O(s),["enter"])},null,40,ze),[[Z,y.value]]),o("button",{class:"btn btn-primary ml-2",disabled:B.value,onClick:l=>O(s)}," Reply ",8,Le),B.value?(r(),c("div",Pe,[h(v)])):d("",!0)])):d("",!0),o("button",{class:"absolute top-2 right-2 text-red-500 hover:text-red-700",onClick:de(l=>te(s),["stop"])}," × ",8,Oe)],8,Ee)}),128))])])}}});export{Je as _};
