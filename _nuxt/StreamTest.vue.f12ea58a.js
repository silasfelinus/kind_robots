import{_ as ae}from"./bot-carousel2.vue.09b389bb.js";import{_ as oe}from"./milestone-reward.vue.e2bcdaac.js";import{d as ne,r as _,o as le,aR as re,X as ce,aS as ue,G as C,aT as j,b as r,c,O as w,e as o,g as h,t as N,f as d,Z as Q,$ as X,aQ as Z,H as ie,F as q,a5 as J,n as I,D as K,Y as de,aG as ve}from"./entry.e51736e9.js";import{_ as me}from"./ResponseEntry.vue.c6956f39.js";import _e from"./Icon.d8a6b9cf.js";import{a as W}from"./axios.47b9d439.js";const pe={class:"container rounded-2xl mx-auto p-2 bg-base-200"},ge={key:0,class:"avatar-container w-full m-2 rounded-lg"},he={class:"flex-grow rounded-2xl m-2 p-2 border bg-base-200"},be={class:"flex-1 text-center"},fe={class:"text-3xl font-bold"},ye={class:"text-xl"},ke={class:"card mt-2"},Ce={class:"message-container bg-base-200 p-1 rounded-2xl"},we={class:"prompt-area p-2 rounded-2xl"},Ie={for:"newMessage",class:"block mb-2 font-bold"},xe={key:0,class:"user-intro p-2 rounded-2xl m-2"},$e={class:"text-lg"},Se=["onKeyup"],Me=["disabled"],Re={key:0,class:"loader flex justify-center mt-2"},Be=["onClick"],Ee={class:"reaction-buttons mt-2 flex space-x-2"},Ne=["onClick"],Ke={key:0,class:"popup"},Ue=["onClick"],De={key:1,class:"popup"},Te=["onClick"],Ve={key:2,class:"popup"},Ae=["onClick"],Fe={key:3,class:"popup"},je={key:0,class:"mt-2 flex items-center"},ze=["onKeyup"],Le=["disabled","onClick"],Oe={key:0,class:"loader flex justify-center mt-2 ml-2"},Pe=["onClick"],Je=ne({__name:"StreamTest",setup(Ge){const z=_(!1);let L=null;le(()=>{L=localStorage.getItem("user_openai_key")});const u=_([]),x=_(null),U=re(),$=ce(),S=ue(),n=C(()=>U.currentBot),b=_(""),y=_(""),M=_(!1),ee=_(null);C(()=>{var e;return(e=$.user)==null?void 0:e.avatarImage});const R=_(!1),D=C(()=>$.userId||0),T=C(()=>{var e;return((e=U.currentBot)==null?void 0:e.id)||0}),V=C(()=>{var e;return((e=U.currentBot)==null?void 0:e.name)||""}),A=C(()=>$.username),p=_({});function F(e,t,a,i,v){var f,s;const g=((f=e.find(k=>k.role==="user"))==null?void 0:f.content)??"",m=((s=e.find(k=>k.role==="assistant"))==null?void 0:s.content)??"";return{id:0,createdAt:new Date,updatedAt:new Date,botId:a,botName:i,userId:t,username:v,userPrompt:g,botResponse:m,liked:null,hated:null,loved:null,flagged:null,previousEntryId:0}}const B=(e,t)=>{const a=S.getExchangeById(e);return a==null?void 0:a[t]};j(()=>{if(u.value.length>0){const e=u.value[u.value.length-1],t=F(e,D.value,T.value,V.value,A.value);S.addOrUpdateExchange(t)}});const O=async()=>{var e,t,a,i,v;M.value=!0;try{const g=(e=n.value)!=null&&e.userIntro?`${n.value.userIntro} ${b.value}`:b.value;z.value=!0;const m=await W.post("/api/botcafe/chat",{model:"gpt-3.5-turbo",messages:[{role:"user",content:g}],stream:!1,user_openai_key:L},{headers:{"Content-Type":"application/json",Accept:"application/json"}});u.value.push([{role:"user",content:b.value,avatarImage:((t=$.user)==null?void 0:t.avatarImage)??void 0},{role:"assistant",content:m.data.choices[0].message.content,avatarImage:(a=n.value)==null?void 0:a.avatarImage,botName:(i=n.value)==null?void 0:i.name,subtitle:(v=n.value)==null?void 0:v.subtitle}]),b.value=""}catch(g){console.error(g),ee.value="Failed to send the message. Please try again."}finally{M.value=!1}},E=(e,t)=>{const a=F(u.value[e],D.value,T.value,V.value,A.value);if(a&&a.id){const i=a[t]??!1;S.addReaction(a.id,{[t]:!i})}p.value[e]||(p.value[e]={}),p.value[e][t]=!0,setTimeout(()=>{p.value[e][t]=!1},2e3)},P=async e=>{var t;R.value=!0;try{const a=u.value[e].map(({avatarImage:g,botName:m,subtitle:f,...s})=>s),i=(t=n.value)!=null&&t.userIntro?`${n.value.userIntro} ${y.value}`:y.value;a.push({role:"user",content:i});const v=await W.post("/api/botcafe/chat",{model:"gpt-3.5-turbo",messages:a,stream:!1});u.value[e].push({role:"user",content:y.value}),u.value[e].push({role:"assistant",content:v.data.choices[0].message.content}),y.value=""}catch(a){console.error(a)}R.value=!1};j(()=>{if(u.value.length>0){const e=u.value[u.value.length-1],t=F(e,D.value,T.value,V.value,A.value);S.addOrUpdateExchange(t)}}),j(()=>{n.value&&n.value.prompt&&(b.value=n.value.prompt)});const te=e=>{u.value.splice(e,1),x.value=null};return(e,t)=>{const a=ae,i=oe,v=ve,g=me,m=_e;return r(),c("div",pe,[w(n)?(r(),c("div",ge,[o("div",he,[h(a),o("div",be,[o("h1",fe,N(w(n).name??"Unknown Bot"),1),o("p",ye,N(w(n).subtitle??"Subtitle"),1),o("div",ke,N(w(n).description??"Description"),1)])])])):d("",!0),o("div",Ce,[o("div",we,[o("label",Ie,[w(n)?(r(),c("div",xe,[o("p",$e,N(w(n).userIntro??"User Intro"),1)])):d("",!0)]),Q(o("textarea",{id:"newMessage","onUpdate:modelValue":t[0]||(t[0]=f=>b.value=f),rows:"5",class:"message-input w-full p-2 rounded-md border-2 resize-none",placeholder:"Type your message...",onKeyup:Z(O,["enter"])},null,40,Se),[[X,b.value]]),o("button",{class:"submit-button btn btn-primary mt-2",disabled:M.value,onClick:O}," Send Message ",8,Me),z.value?(r(),ie(i,{key:0,id:4})):d("",!0)]),M.value?(r(),c("div",Re,[h(v)])):d("",!0),(r(!0),c(q,null,J(u.value,(f,s)=>{var k,G,Y,H;return r(),c("div",{key:s,class:"response-container m-2 p-4 bg-white rounded-md shadow-md relative flex flex-col items-start",onClick:l=>x.value=s},[(r(!0),c(q,null,J(f,(l,se)=>(r(),c("div",{key:se,class:I([{"flex-row-reverse":l.role==="user"},"flex items-center"])},[h(g,{role:l.role,content:l.content,"avatar-image":l.avatarImage??"/images/kindtitle.webp","bot-name":l.botName??"Kind Robot",subtitle:l.subtitle??"Your friendly neighborhood AI"},null,8,["role","content","avatar-image","bot-name","subtitle"])],2))),128)),o("div",Ee,[o("button",{class:I(["hover:bg-gray-200",{"bg-primary":B(s,"liked")}]),onClick:l=>E(s,"liked")}," 👍 ",10,Ne),(k=p.value[s])!=null&&k.liked?(r(),c("div",Ke,[K("Response Liked "),h(m,{name:"like",class:"icon-class"})])):d("",!0),o("button",{class:I(["hover:bg-gray-200",{"bg-primary":B(s,"hated")}]),onClick:l=>E(s,"hated")}," 👎 ",10,Ue),(G=p.value[s])!=null&&G.hated?(r(),c("div",De,[K("Response hated "),h(m,{name:"hate",class:"icon-class"})])):d("",!0),o("button",{class:I(["hover:bg-gray-200",{"bg-primary":B(s,"loved")}]),onClick:l=>E(s,"loved")}," ❤️ ",10,Te),(Y=p.value[s])!=null&&Y.loved?(r(),c("div",Ve,[K("Favorited "),h(m,{name:"❤️",class:"icon-class"})])):d("",!0),o("button",{class:I(["hover:bg-gray-200",{"bg-primary":B(s,"flagged")}]),onClick:l=>E(s,"flagged")}," 🚩 ",10,Ae),(H=p.value[s])!=null&&H.flagged?(r(),c("div",Fe,[K("Flagged "),h(m,{name:"🚩",class:"icon-class"})])):d("",!0)]),x.value!==null&&x.value===s?(r(),c("div",je,[Q(o("textarea",{"onUpdate:modelValue":t[1]||(t[1]=l=>y.value=l),type:"text",rows:"3",placeholder:"Continue conversation...",class:"flex-grow p-2 rounded-md border-2 text-lg resize-y",onKeyup:Z(l=>P(s),["enter"])},null,40,ze),[[X,y.value]]),o("button",{class:"btn btn-primary ml-2",disabled:R.value,onClick:l=>P(s)}," Reply ",8,Le),R.value?(r(),c("div",Oe,[h(v)])):d("",!0)])):d("",!0),o("button",{class:"absolute top-2 right-2 text-red-500 hover:text-red-700",onClick:de(l=>te(s),["stop"])}," × ",8,Pe)],8,Be)}),128))])])}}});export{Je as _};
