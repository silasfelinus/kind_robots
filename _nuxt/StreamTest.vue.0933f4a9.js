import{_ as ae}from"./bot-carousel2.vue.d341e8ae.js";import{_ as oe}from"./milestone-reward.vue.fc9253b8.js";import{d as ne,r as p,o as le,aR as re,X as ce,aS as ue,G as C,aT as F,b as r,c,O as w,e as o,g as h,t as E,f as d,Z as Q,$ as X,aQ as Z,H as ie,F as q,a5 as J,n as x,j as N,Y as de,aG as ve}from"./entry.540372c9.js";import{_ as me}from"./ResponseEntry.vue.011f08f0.js";import pe from"./Icon.98c1e922.js";import{a as W}from"./axios.47b9d439.js";const _e={class:"container rounded-2xl mx-auto p-2 bg-base-200"},ge={key:0,class:"avatar-container w-full m-2 rounded-lg"},he={class:"flex-grow rounded-2xl m-2 p-2 border bg-base-200"},be={class:"flex-1 text-center"},fe={class:"text-3xl font-bold"},ye={class:"text-xl"},ke={class:"card mt-2"},Ce={class:"message-container bg-base-200 p-1 rounded-2xl"},we={class:"prompt-area p-2 rounded-2xl"},xe={for:"newMessage",class:"block mb-2 font-bold"},Ie={key:0,class:"user-intro p-2 rounded-2xl m-2"},$e={class:"text-lg"},Se=["onKeyup"],Me=["disabled"],Re={key:0,class:"loader flex justify-center mt-2"},Be={class:"reaction-buttons mt-2 flex space-x-2"},Ee=["onClick"],Ne={key:0,class:"popup"},Ke=["onClick"],Ue={key:1,class:"popup"},Te=["onClick"],Ve={key:2,class:"popup"},je=["onClick"],Ae={key:3,class:"popup"},De={key:0,class:"mt-2 flex items-center"},Fe=["onKeyup"],ze=["disabled","onClick"],Le={key:0,class:"loader flex justify-center mt-2 ml-2"},Oe=["onClick"],qe=ne({__name:"StreamTest",setup(Pe){const z=p(!1);let L=null;le(()=>{L=localStorage.getItem("user_openai_key")});const u=p([]),K=p(null),U=re(),I=ce(),$=ue(),n=C(()=>U.currentBot),b=p(""),y=p(""),S=p(!1),ee=p(null);C(()=>{var e;return(e=I.user)==null?void 0:e.avatarImage});const M=p(!1),T=C(()=>I.userId||0),V=C(()=>{var e;return((e=U.currentBot)==null?void 0:e.id)||0}),j=C(()=>{var e;return((e=U.currentBot)==null?void 0:e.name)||""}),A=C(()=>I.username),_=p({});function D(e,t,a,i,v){var f,s;const g=((f=e.find(k=>k.role==="user"))==null?void 0:f.content)??"",m=((s=e.find(k=>k.role==="assistant"))==null?void 0:s.content)??"";return{id:0,createdAt:new Date,updatedAt:new Date,botId:a,botName:i,userId:t,username:v,userPrompt:g,botResponse:m,liked:null,hated:null,loved:null,flagged:null,previousEntryId:0}}const R=(e,t)=>{const a=$.getExchangeById(e);return a==null?void 0:a[t]};F(()=>{if(u.value.length>0){const e=u.value[u.value.length-1],t=D(e,T.value,V.value,j.value,A.value);$.addOrUpdateExchange(t)}});const O=async()=>{var e,t,a,i,v;S.value=!0;try{const g=(e=n.value)!=null&&e.userIntro?`${n.value.userIntro} ${b.value}`:b.value;z.value=!0;const m=await W.post("/api/botcafe/chat",{model:"gpt-3.5-turbo",messages:[{role:"user",content:g}],stream:!1,user_openai_key:L},{headers:{"Content-Type":"application/json",Accept:"application/json"}});u.value.push([{role:"user",content:b.value,avatarImage:((t=I.user)==null?void 0:t.avatarImage)??void 0},{role:"assistant",content:m.data.choices[0].message.content,avatarImage:(a=n.value)==null?void 0:a.avatarImage,botName:(i=n.value)==null?void 0:i.name,subtitle:(v=n.value)==null?void 0:v.subtitle}]),b.value=""}catch(g){console.error(g),ee.value="Failed to send the message. Please try again."}finally{S.value=!1}},B=(e,t)=>{const a=D(u.value[e],T.value,V.value,j.value,A.value);if(a&&a.id){const i=a[t]??!1;$.addReaction(a.id,{[t]:!i})}_.value[e]||(_.value[e]={}),_.value[e][t]=!0,setTimeout(()=>{_.value[e][t]=!1},2e3)},P=async e=>{var t;M.value=!0;try{const a=u.value[e].map(({avatarImage:g,botName:m,subtitle:f,...s})=>s),i=(t=n.value)!=null&&t.userIntro?`${n.value.userIntro} ${y.value}`:y.value;a.push({role:"user",content:i});const v=await W.post("/api/botcafe/chat",{model:"gpt-3.5-turbo",messages:a,stream:!1});u.value[e].push({role:"user",content:y.value}),u.value[e].push({role:"assistant",content:v.data.choices[0].message.content}),y.value=""}catch(a){console.error(a)}M.value=!1};F(()=>{if(u.value.length>0){const e=u.value[u.value.length-1],t=D(e,T.value,V.value,j.value,A.value);$.addOrUpdateExchange(t)}}),F(()=>{n.value&&n.value.prompt&&(b.value=n.value.prompt)});const te=e=>{u.value.splice(e,1),K.value=null};return(e,t)=>{const a=ae,i=oe,v=ve,g=me,m=pe;return r(),c("div",_e,[w(n)?(r(),c("div",ge,[o("div",he,[h(a),o("div",be,[o("h1",fe,E(w(n).name??"Unknown Bot"),1),o("p",ye,E(w(n).subtitle??"Subtitle"),1),o("div",ke,E(w(n).description??"Description"),1)])])])):d("",!0),o("div",Ce,[o("div",we,[o("label",xe,[w(n)?(r(),c("div",Ie,[o("p",$e,E(w(n).userIntro??"User Intro"),1)])):d("",!0)]),Q(o("textarea",{id:"newMessage","onUpdate:modelValue":t[0]||(t[0]=f=>b.value=f),rows:"5",class:"message-input w-full p-2 rounded-md border-2 resize-none",placeholder:"Type your message...",onKeyup:Z(O,["enter"])},null,40,Se),[[X,b.value]]),o("button",{class:"submit-button btn btn-primary mt-2",disabled:S.value,onClick:O}," Send Message ",8,Me),z.value?(r(),ie(i,{key:0,id:4})):d("",!0)]),S.value?(r(),c("div",Re,[h(v)])):d("",!0),(r(!0),c(q,null,J(u.value,(f,s)=>{var k,G,Y,H;return r(),c("div",{key:s,class:"response-container m-2 p-4 bg-white rounded-md shadow-md relative flex flex-col items-start"},[(r(!0),c(q,null,J(f,(l,se)=>(r(),c("div",{key:se,class:x([{"flex-row-reverse":l.role==="user"},"flex items-center message-content"])},[h(g,{role:l.role,content:l.content,"avatar-image":l.avatarImage??"/images/kindtitle.webp","bot-name":l.botName??"Kind Robot",subtitle:l.subtitle??"Your friendly neighborhood AI"},null,8,["role","content","avatar-image","bot-name","subtitle"])],2))),128)),o("div",Be,[o("button",{class:x(["hover:bg-gray-200",{"bg-primary":R(s,"liked")}]),onClick:l=>B(s,"liked")}," 👍 ",10,Ee),(k=_.value[s])!=null&&k.liked?(r(),c("div",Ne,[N("Response Liked "),h(m,{name:"like",class:"icon-class"})])):d("",!0),o("button",{class:x(["hover:bg-gray-200",{"bg-primary":R(s,"hated")}]),onClick:l=>B(s,"hated")}," 👎 ",10,Ke),(G=_.value[s])!=null&&G.hated?(r(),c("div",Ue,[N("Response hated "),h(m,{name:"hate",class:"icon-class"})])):d("",!0),o("button",{class:x(["hover:bg-gray-200",{"bg-primary":R(s,"loved")}]),onClick:l=>B(s,"loved")}," ❤️ ",10,Te),(Y=_.value[s])!=null&&Y.loved?(r(),c("div",Ve,[N("Favorited "),h(m,{name:"❤️",class:"icon-class"})])):d("",!0),o("button",{class:x(["hover:bg-gray-200",{"bg-primary":R(s,"flagged")}]),onClick:l=>B(s,"flagged")}," 🚩 ",10,je),(H=_.value[s])!=null&&H.flagged?(r(),c("div",Ae,[N("Flagged "),h(m,{name:"🚩",class:"icon-class"})])):d("",!0)]),K.value!==null&&K.value===s?(r(),c("div",De,[Q(o("textarea",{"onUpdate:modelValue":t[1]||(t[1]=l=>y.value=l),type:"text",rows:"3",placeholder:"Continue conversation...",class:"flex-grow p-2 rounded-md border-2 text-lg resize-y",onKeyup:Z(l=>P(s),["enter"])},null,40,Fe),[[X,y.value]]),o("button",{class:"btn btn-primary ml-2",disabled:M.value,onClick:l=>P(s)}," Reply ",8,ze),M.value?(r(),c("div",Le,[h(v)])):d("",!0)])):d("",!0),o("button",{class:"absolute top-2 right-2 text-red-500 hover:text-red-700",onClick:de(l=>te(s),["stop"])}," × ",8,Oe)])}),128))])])}}});export{qe as _};
